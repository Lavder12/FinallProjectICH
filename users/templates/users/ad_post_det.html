{% extends 'web_room/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/post_det.css' %}">
{% endblock extra_css %}

{% block title %}{{ post.title }}{% endblock title %}

{% block header %}{{ post.title }}{% endblock header %}

{% block content %}
    <div class="post-container">
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">{{ post.title }}</h1>
                <small class="post-date">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.created_at|date:"d.m.Y H:i" }}</small>
            </header>

            <section class="post-details">
                <p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ post.location }}</p>
                <p><strong>–¶–µ–Ω–∞:</strong> {{ post.price }} ‚ÇΩ</p>
                <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç:</strong> {{ post.count_rooms }}</p>
                <p><strong>–¢–∏–ø:</strong> {{ post.get_type_of_room_display }}</p>
                <p><strong>–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä:</strong> {% if post.renter %} {{ post.renter.username }} {% else %} –ù–µ—Ç
                    –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ {% endif %}</p>
            </section>

            <section class="post-content">
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
                <p>{{ post.content|linebreaks }}</p>
            </section>

            {% if post.image %}
                <div class="post-image">
                    <img src="{{ post.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è {{ post.title }}">
                </div>
            {% endif %}

            <!-- üîπ –í—Å—Ç–∞–≤–ª—è–µ–º —Å—é–¥–∞ –æ—Ç–∑—ã–≤—ã -->
            <div class="reviews-section">
                <h2>–û—Ç–∑—ã–≤—ã</h2>

                {% if post.reviews.exists %}
                    <ul>
                        {% for review in post.reviews.all %}
                            <li>
                                <strong>{{ review.author.username }}</strong> - {{ review.rating }}‚≠ê
                                <p>{{ review.comment }}</p>
                                <small>–î–∞—Ç–∞: {{ review.created_at|date:"d.m.Y H:i" }}</small>

                                {% if review.author == user %}
                                    <form action="{% url 'users:delete_review' review.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="delete-button">–£–¥–∞–ª–∏—Ç—å</button>
                                    </form>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</p>
                {% endif %}

                <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
                <form action="{% url 'users:add_review' post.id %}" method="post">
                    {% csrf_token %}

                    <label for="rating">–û—Ü–µ–Ω–∫–∞:</label>
                    <select name="rating" id="rating" required>
                        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥</option>
                        <option value="1">1‚≠ê</option>
                        <option value="2">2‚≠ê</option>
                        <option value="3">3‚≠ê</option>
                        <option value="4">4‚≠ê</option>
                        <option value="5">5‚≠ê</option>
                    </select>

                    {{ form.comment }}

                    <button type="submit" class="submit-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
            </div>
            <!-- üîπ –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ -->

            <section class="post-actions">
                {% if not post.active %}
                    <form method="post" action="{% url 'users:restore_ad' post.id %}">
                        {% csrf_token %}
                        <button type="submit" class="restore-button">–í–µ—Ä–Ω—É—Ç—å –≤ –ø–æ–∏—Å–∫</button>
                    </form>
                {% endif %}

                {% if post.author == user %}
                    <a href="{% url 'users:edit_ad' post.id %}" class="edit-link">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
                {% endif %}
            </section>

            <a href="{% url 'users:rented_ads' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        </article>
    </div>
{% endblock content %}
