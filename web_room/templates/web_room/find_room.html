{% extends "web_room/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/find_room.css' %}">
{% endblock extra_css %}

{% block title %}–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π{% endblock title %}

{% block header %}–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π{% endblock header %}

{% block content %}
    <h1 class="page-title">–ù–∞–π–¥–∏—Ç–µ –∂–∏–ª—å–µ –¥–ª—è –Ω–æ–≤–æ–π –ø–æ–µ–∑–¥–∫–∏</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form method="get" action="" class="search-form">
        <div class="search-row">
            <div class="search-input-container">
                <label for="id_q"></label>
                {{ form.q }}
            </div>
            <div class="search-button-container">
                <button type="submit" class="search-button">–ò—Å–∫–∞—Ç—å</button>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="advanced-toggle">
            <button type="button" id="toggle-filters" class="toggle-button">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ ‚ñº</button>
        </div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π –±–ª–æ–∫ -->
        <div id="advanced-filters" class="advanced-filters">
            <div class="search-row">
                <div class="search-input-container">
                    <label for="id_location">–ì–æ—Ä–æ–¥</label>
                    {{ form.location }}
                </div>
                <div class="search-input-container">
                    <label for="id_rooms">–ö–æ–º–Ω–∞—Ç</label>
                    {{ form.rooms }}
                </div>
                <div class="search-input-container">
                    <label for="id_type">–¢–∏–ø</label>
                    {{ form.type }}
                </div>
            </div>

            <div class="search-row">
                <div class="search-input-container small">
                    <label for="id_min_price">–¶–µ–Ω–∞ –æ—Ç</label>
                    {{ form.min_price }}
                </div>
                <div class="search-input-container small">
                    <label for="id_max_price">–¶–µ–Ω–∞ –¥–æ</label>
                    {{ form.max_price }}
                </div>
            </div>

            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
            <div class="sort-container">
                <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
                <select id="sort" class="sort-select">
                    <option value="?{% url 'web_room:find_room' %}&sort=rating_desc"
                            {% if sort == 'rating_desc' %}selected{% endif %}>‚≠ê –û—Ü–µ–Ω–∫–∞ ‚Üì
                    </option>
                    <option value="?{% url 'web_room:find_room' %}&sort=rating_asc"
                            {% if sort == 'rating_asc' %}selected{% endif %}>‚≠ê –û—Ü–µ–Ω–∫–∞ ‚Üë
                    </option>
                    <option value="?{% url 'web_room:find_room' %}&sort=date_desc"
                            {% if sort == 'date_desc' %}selected{% endif %}>üìÖ –î–∞—Ç–∞ ‚Üì
                    </option>
                    <option value="?{% url 'web_room:find_room' %}&sort=date_asc"
                            {% if sort == 'date_asc' %}selected{% endif %}>üìÖ –î–∞—Ç–∞ ‚Üë
                    </option>
                    <option value="?{% url 'web_room:find_room' %}&sort=price_desc"
                            {% if sort == 'price_desc' %}selected{% endif %}>üí∞ –¶–µ–Ω–∞ ‚Üì
                    </option>
                    <option value="?{% url 'web_room:find_room' %}&sort=price_asc"
                            {% if sort == 'price_asc' %}selected{% endif %}>üí∞ –¶–µ–Ω–∞ ‚Üë
                    </option>
                </select>
            </div>
        </div>
    </form>

    <script>
        document.getElementById("toggle-filters").addEventListener("click", function () {
            var filters = document.getElementById("advanced-filters");
            filters.classList.toggle("show");
            this.innerText = filters.classList.contains("show") ? "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ ‚ñ≤" : "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ ‚ñº";
        });

        document.getElementById("sort").addEventListener("change", function () {
            window.location.href = this.value;
        });
    </script>

    <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è -->
    <div class="posts-grid">
        {% if page_obj %}
            {% for post in page_obj %}
                <div class="post">
                    <h2 class="post-title">
                        <a href="{% url 'web_room:post_detail' pk=post.pk %}">{{ post.title }}</a>

                    </h2>
                    <p class="post-content">{{ post.content|truncatechars:170 }}</p>
                    <p><strong>‚≠ê –û—Ü–µ–Ω–∫–∞:</strong> {{ post.rating }}</p>
                    <p><strong>üí∞ –¶–µ–Ω–∞:</strong> {{ post.price }} ‚ÇΩ</p>
                    <p><strong>üìÖ –î–∞—Ç–∞:</strong> {{ post.created_at }}</p>

                    {% if post.image %}
                        <div class="post-image">
                            <img src="{{ post.image.url }}" alt="{{ post.title }}">
                        </div>
                    {% endif %}

                    <small class="post-date">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.created_at }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-posts">–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        {% endif %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&sort={{ sort }}" class="pagination-link">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}

        <span class="pagination-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&sort={{ sort }}" class="pagination-link">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
        {% endif %}
    </div>

{% endblock content %}
